<html>
    <head>
        <title>J!ometry: Daily Jeopardy Visualizations</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto">
        <link rel="stylesheet" href="css/site.css"></link>
        <link rel="stylesheet" href="css/game.css"></link>
        <script src="https://cdn.plot.ly/plotly-2.12.1.min.js"></script>
        <script src="/js/d3/d3.v7.min.js"></script>
        <script src="/js/util/util.v2.js"></script>
        <script src="/js/graphs/full_game_scatter.v3.js"></script>
        <script src="/js/graphs/by_round_scatter.v1.js"></script>
        <script src="/js/graphs/scatterhist.v1.js"></script>
        <script src="/js/util/shared_graph_production.v4.js"></script>
    </head>
    <body>
        <h1><a href="index.html">J!ometry</a></h1>
        <div>
            <a href="/index.html">Home</a>&nbsp;<a href="/glossary.html">Glossary</a>
        </div>
        <div class="section">
            <h1><span id="toc-period-id"></span> Season <span id="season"></span> Game <span id="game-number"></span> Summary <span id="game-date"></span></h1>
            <div id="game-summary">
                <table>
                    <thead>
                        <tr>
                            <th colspan="1" class="empty"></th>
                            <th colspan="7">Jeopardy! Round, GCon <span id="j-gcon"></span></th>
                            <th colspan="7">Double Jeopardy! Round, GCon <span id="dj-gcon"></span></th>
                            <th colspan="3" class="empty"></th>
                        </tr>
                        <tr>
                            <th>Contestant</th>
                            <th>Att</th>
                            <th>BuzC</th>
                            <th>Speed</th>
                            <th>Buz$</th>
                            <th>DD$</th>
                            <th>DDF</th>
                            <th>DD+</th>
                            <th>Att</th>
                            <th>BuzC</th>
                            <th>Speed</th>
                            <th>Buz$</th>
                            <th>DD$</th>
                            <th>DDF</th>
                            <th>DD+</th>
                            <th>Total Buz$</th>
                            <th>Total DD$</th>
                            <th>DJ! Final Score</th>
                            <th>FJ! Final Score</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="graph-description">
                GCon = Game contention, Att = Attempts, BuzC = Correct on buzz,
                Speed = Est. buzzes created through speed, Solo = Estimated buzzes uncontested,
                Buz$ = Score on buzz, DDF = Daily Doubles found, DD+ = Daily Doubles found above expectation
            </div>
        </div>
        <div class="section" id="contention">
            <h1>Contention</h1>
            <div class="graph-description">
                The estimated percentage of clues where a response is blocked by someone else responding correctly.
            </div>
            <div id="scatterhist-gcon" style="width:400px;height:400px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Attempts</h1>
            <div class="graph-description">
                Attempts by contestants. Successful, correct buzzes are shown full color at the bottom. Buzzes with incorrect
                responses are shown in the middle. Attempts that were blocked are shown on top (if known).
            </div>
            <div style="display:flex">
                <div id="bar-attempts-j" style="width:400px;height:500px;margin-bottom:1em;"></div>
                <div id="bar-attempts-dj" style="width:400px;height:500px;margin-bottom:1em;"></div>
            </div>
        </div>
        <div class="section">
            <h1>Player Statistics</h1>
            <div class="graph-description">
                A collection of player statistics for this game, with the distribution of player performance for the play period shown in gray.
            </div>
            <div id="scatterhist-att-buz%" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="scatterhist-buz-buz$-per-buz" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="scatterhist-speed-solo" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="hist-att" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="hist-buz" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="hist-buzc" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="hist-buz$" style="width:1000px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div id="footer">
            <p>This site is not affiliated with Jeopardy!. Data is taken from their published <a href="https://www.jeopardy.com/jbuzz/news-events/jeopardy-daily-box-scores">box scores.</a></p>
        </div>
        <script type="text/javascript">
            var tocPeriodId = new URLSearchParams(window.location.search).get('toc_period_id');
            var highlightGame = new URLSearchParams(window.location.search).get('game_id');
            d3.select("#toc-period-id")
                .data([tocPeriodId])
                .text(d => d);
            d3.csv(csvUrlForTocPeriod(tocPeriodId)).then(function(data) {
                var margin = {top: 20, right: 20, bottom: 50, left: 70},
                    width = 960 - margin.left - margin.right,
                    height = 500 - margin.top - margin.bottom;

                //Data transformations
                data.forEach(function(d) {
                    d['Date'] = csvDateParse(d['Date']);
                    d['JBuz%'] = 100.0 * d['JBuz'] / d['JAtt'];
                    d['JGCon%'] = 100.0 * d['JGCon'];
                    d['DJBuz%'] = 100.0 * d['DJBuz'] / d['DJAtt'];
                    d['DJGCon%'] = 100.0 * d['DJGCon'];
                    d['Buz%'] = 100.0 * d['Buz'] / d['Att'];
                    d['highlightGame'] = d['Jometry Game Id'] == highlightGame;
                    d['FJ$'] = d['FJCor'] === "" ? 0 : (2 * +d['FJCor'] - 1) * +d['FJWager'];
                });
                var highlightGameData = d3.filter(data, d => d['highlightGame']);

                d3.select("#season").data([highlightGameData[0]]).text(d => d['Season']);
                d3.select("#game-number").data([highlightGameData[0]]).text(d => d['Game In Season']);
                d3.select("#game-date").data([highlightGameData[0]]).text(d => dateFormat(d['Date']));
                var highlightGameContestantIds = d3.map(highlightGameData, d => d['Jometry Contestant Id']);
                data.forEach(function(d) {
                    d['highlightContestant'] = highlightGameContestantIds.includes(d['Jometry Contestant Id']);
                });

                //Graphics functions
                var color = d3.scaleOrdinal()
                    .domain(highlightGameContestantIds)
                    .range(['#0072B2','#E69F00','#009E73'])
                var highlightGameColorFunction = function(d) {
                    if (d['highlightGame'] || d['highlightContestant']) {
                        return color(d['Jometry Contestant Id']);
                    } else {
                        return "black";
                    }
                };
                var highlightGameLabelFunction = function(d) {
                    if (d['highlightGame']) {
                        return d['Contestant'];
                    }
                };

                //Summary table
                var summaryTr = d3.select("#game-summary table tbody")
                    .selectAll("tr")
                    .data(highlightGameData)
                    .enter()
                    .append("tr");
                d3.select("#game-summary span#j-gcon")
                    .text((100 * highlightGameData[0]['JGCon']).toFixed(0) + "%");
                d3.select("#game-summary span#dj-gcon")
                    .text((100 * highlightGameData[0]['DJGCon']).toFixed(0) + "%");
                summaryTr.selectAll("td")
                    .data(function(d,i) {
                        return [
                            [d['Jometry Contestant Id'], d['Contestant']],
                            d['JAtt'],
                            d['JBuzC'],
                            d['JAtt'] === '' ? '' : (+d['JSpeed'] > 0 ? "+" : "" ) + (+d['JSpeed']).toFixed(1),
                            d['JBuz$'],
                            d['JDD'] === '' ? '' : +d['JDD'],
                            d['JDDF'],
                            (+d['JDD+'] > 0 ? "+" : "" ) + (+d['JDD+']).toFixed(2),
                            d['DJAtt'],
                            d['DJBuzC'],
                            d['DJAtt'] === '' ? '' : (+d['DJSpeed'] > 0 ? "+" : "" ) + (+d['DJSpeed']).toFixed(1),
                            d['DJBuz$'],
                            (d['DJDD1'] === '' && d['DJDD2'] === '') ? '' : (d['DJDD1'] === '' ? 0 : +d['DJDD1']) + (d['DJDD2'] === '' ? 0 : +d['DJDD2']),
                            d['DJDDF'],
                            (+d['DJDD+'] > 0 ? "+" : "" ) + (+d['DJDD+']).toFixed(2),
                            d['Buz$'],
                            (d['JDD'] === '' && d['DJDD1'] === '' && d['DJDD2'] === '') ? '' : (d['JDD'] === '' ? 0 : +d['JDD']) + (d['DJDD1'] === '' ? 0 : +d['DJDD1']) + (d['DJDD2'] === '' ? 0 : +d['DJDD2']),
                            d['DJFinal$'],
                            d['FJFinal$']
                        ];
                    })
                    .enter()
                    .append("td")
                    .html(function(d,i) {
                        if (i>0) return d;
                        return '<span style="color: ' + color(d) + '">&#9632;</span>&nbsp;<a href="contestant.html?toc_period_id=' + tocPeriodId + '&contestant=' + d[0] + '">' + d[1] + "</a>";
                    });

                var hasBoxScoreData = d3.filter(data, d => d['highlightGame'] && d['Att'] !== '').length > 0;

                if (hasBoxScoreData) {
                    var gConData = d3.filter(data, d => +d['Podium'] === 1 && d['JGCon'] !== '' && d['DJGCon'] !== '');
                    var gConMin = d3.min(d3.map(gConData, d => d3.min([d['JGCon%'], d['DJGCon%']])));
                    gConMin = 10 * Math.floor(gConMin / 10.0);
                    var gConMax = d3.max(d3.map(gConData, d => d3.max([d['JGCon%'], d['DJGCon%']])));
                    gConMax = 10 * Math.ceil(gConMax / 10.0);

                    //Scatter GCON
                    var gconHistTrace = {
                        x: d3.map(gConData, d => d['JGCon%']),
                        y: d3.map(gConData, d => d['DJGCon%']),
                        autobinx: false,
                        xbins: {
                            start: gConMin,
                            end: gConMax,
                            size: 5
                        },
                        ybins: {
                            start: gConMin,
                            end: gConMax,
                            size: 5
                        },
                        type: 'histogram2d',
                        colorscale : [['0' , 'white'],['1', '#999999']]
                    };
                    var gconScatterTrace = {
                        x: d3.map(d3.filter(gConData, d => d['highlightGame']), d => d['JGCon%']),
                        y: d3.map(d3.filter(gConData, d => d['highlightGame']), d => d['DJGCon%']),
                        mode: 'markers',
                        marker: {
                            symbol: 'circle',
                            opacity: 1,
                            color: 'black',
                        },
                        type: 'scatter'
                    };
                    var gconScatterLayout = {
                        title: 'Contention',
                        xaxis: {
                            title: 'J! Contention'
                        },
                        yaxis: {
                            title: 'DJ! Contention'
                        }
                    };
                    Plotly.newPlot('scatterhist-gcon', [gconScatterTrace, gconHistTrace], gconScatterLayout);

                    //Speed/Solo
                    renderHighlightScatterHistogram(
                        data,
                        'scatterhist-speed-solo',
                        'Speed and Solo',
                        d => d['Speed'] !== '' && d['Solo'] !== '',
                        d => d['highlightGame'],
                        'Speed',
                        d => d['Speed'],
                        { start: -20.5, end: 20.5, size: 1 },
                        'Solo',
                        d => d['Solo'],
                        { start: 0, end: 25, size: 1 },
                        highlightGameColorFunction,
                        highlightGameLabelFunction
                    );

                    //Att/Buz%
                    renderHighlightScatterHistogram(
                        data,
                        'scatterhist-att-buz%',
                        'Att and Buz%',
                        d => d['Att'] !== '' && d['Buz%'] !== '',
                        d => d['highlightGame'],
                        'Att',
                        d => d['Att'],
                        { start: -0.5, end: 57.5, size: 1 },
                        'Buz%',
                        d => d['Buz%'],
                        { start: 0, end: 100, size: 5 },
                        highlightGameColorFunction,
                        highlightGameLabelFunction
                    );

                    renderHighlightHistogram(
                        data,
                        'hist-att',
                        'Attempts',
                        d => d['Att'] !== '',
                        d => d['highlightGame'],
                        'Att',
                        d => +d['Att'],
                        { start: -0.5, end: 57.5, size: 1 },
                        highlightGameColorFunction,
                        highlightGameLabelFunction
                    );

                } else {
                    ids = ['contention', 'scatterhist-att-buz%', 'scatterhist-speed-solo', 'hist-att'];
                    ids.forEach(id => {
                        document.getElementById(id).style.display = 'none';
                    });
                }

                //Buz vs Buz$/Buz
                renderHighlightScatterHistogram(
                    data,
                    'scatterhist-buz-buz$-per-buz',
                    'Buz vs Buz$/Buz',
                    d => true,
                    d => d['highlightGame'],
                    'Buz',
                    d => d['Buz'],
                    { start: -0.5, end: 45.5, size: 1 },
                    'Buz$/Buz',
                    d => d['Buz$/Buz'],
                    { start: -650, end: 1150, size: 100 },
                    highlightGameColorFunction,
                    highlightGameLabelFunction
                );

                renderHighlightHistogram(
                    data,
                    'hist-buz',
                    'Buzzes',
                    d => true,
                    d => d['highlightGame'],
                    'Buz',
                    d => +d['Buz'],
                    { start: -0.5, end: 57.5, size: 1 },
                    highlightGameColorFunction,
                    highlightGameLabelFunction
                );

                renderHighlightHistogram(
                    data,
                    'hist-buzc',
                    'Correct Buzzes',
                    d => true,
                    d => d['highlightGame'],
                    'BuzC',
                    d => +d['JBuzC'] + +d['DJBuzC'],
                    { start: -0.5, end: 57.5, size: 1 },
                    highlightGameColorFunction,
                    highlightGameLabelFunction
                );

                renderHighlightHistogram(
                    data,
                    'hist-buz$',
                    'Buz$',
                    d => true,
                    d => d['highlightGame'],
                    'Buz$',
                    d => +d['Buz$'],
                    { start: -20000, end: 100000, size: 1000 },
                    highlightGameColorFunction,
                    highlightGameLabelFunction
                );

                //Attempts
                var attemptsTraceJBuzC = {
                    x: d3.map(highlightGameContestantIds, cid => getContestantNameFromData(data, cid)),
                    y: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['JBuzC']))),
                    text: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['JBuzC']))),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightGameContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        }
                    }
                };
                var attemptsTraceJBuzI = {
                    x: d3.map(highlightGameContestantIds, cid => getContestantNameFromData(data, cid)),
                    y: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['JBuzInc']))),
                    text: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['JBuzInc']))),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightGameContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        },
                        opacity: 0.6
                    }
                };
                var attemptsTraceJAttBlocked = {
                    x: d3.map(highlightGameContestantIds, cid => getContestantNameFromData(data, cid)),
                    y: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame'] && cd['Att'] !== ''), cd1 => +cd1['JAtt'] - +cd1['JBuz']))),
                    text: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame'] && cd['Att'] !== ''), cd1 => +cd1['JAtt'] - +cd1['JBuz']))),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightGameContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        },
                        opacity: 0.2
                    }
                };
                var attemptsJData = [attemptsTraceJBuzC, attemptsTraceJBuzI, attemptsTraceJAttBlocked];
                var attemptsJLayout = {
                    barmode: 'stack',
                    showlegend: false,
                    yaxis: {
                        title: {
                            text: "J! Attempts",
                            standoff: 20
                        },
                        range: [0, 29]
                    }
                };
                Plotly.newPlot('bar-attempts-j', attemptsJData, attemptsJLayout);

                var attemptsTraceDJBuzC = {
                    x: d3.map(highlightGameContestantIds, cid => getContestantNameFromData(data, cid)),
                    y: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['DJBuzC']))),
                    text: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['DJBuzC']))),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightGameContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        }
                    }
                };
                var attemptsTraceDJBuzI = {
                    x: d3.map(highlightGameContestantIds, cid => getContestantNameFromData(data, cid)),
                    y: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['DJBuzInc']))),
                    text: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame']), cd1 => +cd1['DJBuzInc']))),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightGameContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        },
                        opacity: 0.6
                    }
                };
                var attemptsTraceDJAttBlocked = {
                    x: d3.map(highlightGameContestantIds, cid => getContestantNameFromData(data, cid)),
                    y: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame'] && cd['Att'] !== ''), cd1 => +cd1['DJAtt'] - +cd1['DJBuz']))),
                    text: d3.map(highlightGameContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c && cd['highlightGame'] && cd['Att'] !== ''), cd1 => +cd1['DJAtt'] - +cd1['DJBuz']))),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightGameContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        },
                        opacity: 0.2
                    }
                };
                var attemptsDJData = [attemptsTraceDJBuzC, attemptsTraceDJBuzI, attemptsTraceDJAttBlocked];
                var attemptsDJLayout = {
                    barmode: 'stack',
                    showlegend: false,
                    yaxis: {
                        title: {
                            text: "DJ! Attempts",
                            standoff: 20
                        },
                        range: [0, 29]
                    }
                };
                Plotly.newPlot('bar-attempts-dj', attemptsDJData, attemptsDJLayout);
            });
        </script>
    </body>
</html>